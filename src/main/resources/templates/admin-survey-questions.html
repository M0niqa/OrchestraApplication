<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <title>Manage Survey for [[${projectName}]]</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container py-5">
<h2>Survey Questions for Project: <span th:text="${projectName}"></span></h2>
<div th:if="${survey.closed}" class="alert alert-warning">
    Survey is closed.
</div>

<h4>Existing Questions:</h4>
<ul>
    <li th:each="question : ${questions}">
        <span th:text="${question.questionText}"></span>
        <div>Count of "yes" answers: <span th:text="${question.getYesCount()}"></span></div>
        <div>Count of "no" answers: <span th:text="${question.getNoCount()}"></span></div>
        <form th:action="@{/admin/project/{projectId}/survey/{questionId}/delete(projectId=${projectId}, questionId=${question.id})}" method="post" style="display:inline;">
            <button type="submit" class="btn btn-danger btn-sm">Delete</button>
        </form>
    </li>
</ul>
<div>Missing submissions: <span th:text="${missingSubmissions}"></span></div>

<hr>
<h4>Add New Question</h4>
<form th:action="@{/admin/project/{id}/survey(id=${projectId})}"
      th:object="${surveyQuestionDTO}" method="post">

    <div class="mb-3">
        <label>Question Text</label>
        <label>
            <input type="text" th:field="*{questionText}" class="form-control" required/>
        </label>
        <div class="text-danger" th:if="${#fields.hasErrors('questionText')}" th:errors="*{questionText}"></div>
    </div>

    <button type="submit" class="btn btn-primary">Add Question</button>
</form>
<div class="mb-3">
    <form th:action="@{/admin/project/{id}/survey/toggle(id=${projectId})}" method="post">
        <button type="submit" class="btn"
                th:classappend="${survey.closed} ? 'btn-success' : 'btn-warning'">
            <span th:text="${survey.closed} ? 'Reopen Survey' : 'Close Survey'"></span>
        </button>
    </form>
</div>

<p><a th:href="@{/adminPage}">Back to Admin home page</a></p>
</body>
</html>
